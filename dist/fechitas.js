/*! fechitas - v0.2.0 - 2015-03-04
* https://jaimerodas.github.io/fechitas
* Copyright (c) 2015 Jaime Rodas; Licensed MIT */
!function(a){a.fn.fechitas=function(b){var c=a.extend({type:"day",format:"normal",capitalized:!1},b);if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))return this;a("body").append('<div class="fechitas-container" style="display:none;"><div class="fechitas-box"><div class="fechitas-decade fechitas-panel"><div class="fechitas-decade-years"></div></div><div class="fechitas-year fechitas-panel"><button type="button" class="fechitas-chooseDecade fechitas-choose"></button><div class="fechitas-year-months"></div></div><div class="fechitas-month fechitas-panel"><button type="button" class="fechitas-chooseDecade fechitas-choose"></button><button type="button" class="fechitas-chooseYear fechitas-choose"></button><div class="fechitas-month-days"></div></div></div></div>');var d,e,f,g,h,i,j=a("body").find(".fechitas-container"),k="enero febrero marzo abril mayo junio julio agosto septiembre octubre noviembre diciembre".split(" "),l="ene feb mar abr may jun jul ago sep oct nov dic".split(" ");String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};var m=function(a,b){b=void 0===b?!1:b;var c,d,e,f=j.find(".fechitas-decade"),h=f.find(".fechitas-decade-years");for(h.html(""),c=b?a.toString():a.toString().substr(0,3),d=0;10>d;d++)e='<button type="button" class="fechitas-chooseYear',c+d==g.toString()&&(e+=" fechitas-active"),e+='" value="'+c+d+'">'+c+d+"</button>",h.append(e);c=parseInt(c,10),h.prepend('<button type="button" class="fechitas-chooseDecade fechitas-choose" value="'+(c-1)+'">'+(c-1)+'0\'s</button><button type="button" class="fechitas-chooseDecade fechitas-choose" value="'+(c+1)+'">'+(c+1)+"0's</button>")},n=function(a){var b,c,d=j.find(".fechitas-year"),e=d.find(".fechitas-year-months").html(""),f=a.toString().substr(0,3);for(d.find(".fechitas-chooseDecade").text(a).val(f),b=0;12>b;b++)c='<button class="fechitas-chooseMonth',b==h&&(c+=" fechitas-active"),c+='" value="'+b+'" type="button">'+k[b].capitalize()+"</button>",e.append(c)},o=function(){var a=g.toString().substr(0,3);j.find(".fechitas-year").find(".fechitas-chooseDecade").val(a).text(g),j.find(".fechitas-month").find(".fechitas-chooseDecade").val(a).text(g),j.find(".fechitas-month").find(".fechitas-chooseYear").val(g).text(k[h].capitalize())},p=function(a,b){return/8|3|5|10/.test(b)?30:1!=b?31:a%4===0&&a%100!==0||a%400===0?29:28},q=function(a,b){var c,d,e=p(a,b),f=j.find(".fechitas-month"),g=f.find(".fechitas-month-days");for(g.html(""),c=1;e>=c;c++)d='<button type="button" class="fechitas-chooseDay',c==i&&(d+=" fechitas-active"),d+='" value="'+c+'">'+c+"</button>",g.append(d)},r=function(a){return 10>a?"0"+a:a},s=function(b){a(b).siblings().removeClass("fechitas-active"),a(b).addClass("fechitas-active")},t=function(a){var b=j.find(a);b.siblings().hide(),b.show()},u=function(b){d=a(b),e=d.get(0).nodeName.toLowerCase();var j=d.data("fecha");j?f=new Date(j):(f="input"==e?d.val():d.html(),f=""===f?new Date:new Date(f),("[object Date]"!==Object.prototype.toString.call(f)||isNaN(f.getTime()))&&(f=new Date)),g=f.getUTCFullYear(),h=f.getUTCMonth(),i=f.getUTCDate(),m(g),n(g),"day"==c.type&&(q(g,h),o())},v=function(){var a,b="invalid format",d="-";switch("verbose"==c.format&&(a=l[f.getMonth()]),"veryverbose"==c.format&&(a=k[f.getMonth()],d=" "),"verbose"!=c.format&&"veryverbose"!=c.format||!c.capitalized||(a=a.capitalize()),c.format){case"normal":b=f.getUTCFullYear()+d+r(f.getUTCMonth()+1);break;case"inverse":b=r(f.getUTCMonth()+1)+d+f.getUTCFullYear();break;case"verbose":case"veryverbose":b=a+d+f.getUTCFullYear()}return"day"==c.type&&("normal"==c.format?b+=d+r(f.getUTCDate()):b=r(f.getUTCDate())+d+b),b},w=function(){f=new Date(g,h,i);var a=v();"input"==e?d.val(a):d.text(a),d.data("fecha",f.toJSON()),j.fadeOut(300),d.trigger("fechitasDateChange",[a,f.toJSON])};return u(this),d.on("focus",function(){u(this),t("month"==c.type?".fechitas-year":".fechitas-month"),j.fadeIn(500)}),j.on("click",function(){j.fadeOut(300)}),j.on("click",".fechitas-chooseDecade",function(b){var c=parseInt(a(this).val(),10);m(c,!0),t(".fechitas-decade"),b.stopPropagation()}),j.on("click",".fechitas-chooseYear",function(b){g=parseInt(a(this).val(),10),a(this).parent().hasClass(".fechitas-month")&&s(this),o(),t(".fechitas-year"),b.stopPropagation()}),j.on("click",".fechitas-chooseMonth",function(b){return h=parseInt(a(this).val(),10),s(this),"month"==c.type?(w(),this):(q(g,h),o(),t(".fechitas-month"),void b.stopPropagation())}),j.on("click",".fechitas-chooseDay",function(){i=parseInt(a(this).val(),10),s(this),w()}),this}}(jQuery);